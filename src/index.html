<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hexor Utility</title>
  <style>
    .titlebar {
      height: 28px;
      width: 100%;
      -webkit-app-region: drag;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 999;
      background: rgba(255, 0, 0, 0);
    }

    html,
    body {
      margin: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      font-weight: normal;
      color: #000;
      background-color: #fff;
      overflow: hidden;
    }

    body {
      display: flex;
      height: 100vh;
      width: 100vw;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    .color-box {
      flex: 1;
      height: 100vh;
      border: none;
    }

    .controls {
      width: 350px;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: column;
      gap: 15px;
      color: #000;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    label {
      width: 20px;
    }

    input[type="range"] {
      flex-grow: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 3px;
      background: transparent;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: none;
      background: currentColor;
      cursor: pointer;
      margin-top: -4px;
      position: relative;
      z-index: 2;
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: none;
      background: currentColor;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    input[type="range"]::-moz-range-track {
      background: transparent;
      height: 6px;
    }

    input[type="range"].red {
      color: red;
    }

    input[type="range"].green {
      color: green;
    }

    input[type="range"].blue {
      color: blue;
    }

    input[type="number"],
    input[type="text"] {
      font-size: 1rem;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    input[type="number"] {
      width: 50px;
    }

    input[type="text"] {
      width: 150px;
      text-transform: lowercase;
    }

    select {
      font-size: 1rem;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      user-select: none;
    }

    p {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 0;
      font-weight: normal;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #f0f0f0;
      }

      .controls {
        background-color: #1e1e1e;
        color: #f0f0f0;
      }

      input,
      select {
        background-color: #2a2a2a;
        color: #f0f0f0;
        border-color: #555;
      }

      input[type="text"]::placeholder {
        color: #aaa;
      }
    }
  </style>
</head>

<body>
  <div class="titlebar"></div>
  <div class="color-box" id="colorBox" aria-live="polite" aria-label="Color preview box"></div>
  <div class="controls" role="region" aria-label="Color controls">
    <div class="slider-container">
      <label for="red">R</label>
      <input type="range" id="red" class="red" min="0" max="255" value="255" aria-label="Red value slider" />
      <input type="number" id="redNumber" min="0" max="255" value="255" aria-label="Red value input" />
    </div>
    <div class="slider-container">
      <label for="green">G</label>
      <input type="range" id="green" class="green" min="0" max="255" value="0" aria-label="Green value slider" />
      <input type="number" id="greenNumber" min="0" max="255" value="0" aria-label="Green value input" />
    </div>
    <div class="slider-container">
      <label for="blue">B</label>
      <input type="range" id="blue" class="blue" min="0" max="255" value="0" aria-label="Blue value slider" />
      <input type="number" id="blueNumber" min="0" max="255" value="0" aria-label="Blue value input" />
    </div>
    <p>
      <select id="colorFormat" aria-label="Select color format">
        <option value="hex" selected>HEX</option>
        <option value="hsl">HSL</option>
        <option value="cmyk">CMYK</option>
        <option value="lch">LCH</option>
      </select>
      <input type="text" id="colorInput" maxlength="20" value="#ff0000" aria-label="Color value input"
        spellcheck="false" />
    </p>
  </div>

  <script>
    function setRGBandUpdate(r, g, b) {
      sliderElements.red.value = r;
      sliderElements.green.value = g;
      sliderElements.blue.value = b;
      updateColorDisplay(r, g, b);
    }

    const sliders = ["red", "green", "blue"];
    const sliderElements = {};
    const numberInputs = {};
    const valueDisplays = {
      colorInput: document.getElementById("colorInput"),
      colorBox: document.getElementById("colorBox"),
      formatSelect: document.getElementById("colorFormat"),
    };

    sliders.forEach((color) => {
      sliderElements[color] = document.getElementById(color);
      numberInputs[color] = document.getElementById(color + "Number");
    });

    function updateSliderFill(slider) {
      const val = Number(slider.value);
      const min = Number(slider.min);
      const max = Number(slider.max);
      const percent = ((val - min) / (max - min)) * 100;

      let color;
      if (slider.id === "red") color = "255, 0, 0";
      else if (slider.id === "green") color = "0, 128, 0";
      else if (slider.id === "blue") color = "0, 0, 255";

      const isDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const trackColor = isDark ? "#444" : "#ccc";

      slider.style.background = `linear-gradient(to right, rgb(${color}) ${percent}%, ${trackColor} ${percent}%)`;
    }

    function componentToHex(c) {
      const hex = c.toString(16);
      return hex.length == 1 ? "0" + hex : hex;
    }

    function rgbToHex(r, g, b) {
      return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}`;
    }

    function hexToRgb(hex) {
      hex = hex.replace(/^#/, "");
      if (hex.length === 3) hex = hex.split("").map((ch) => ch + ch).join("");
      if (hex.length !== 6) return null;
      const bigint = parseInt(hex, 16);
      if (isNaN(bigint)) return null;
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return { r, g, b };
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
    }

    function rgbToCmyk(r, g, b) {
      if (r === 0 && g === 0 && b === 0) return { c: 0, m: 0, y: 0, k: 100 };
      let c = 1 - r / 255;
      let m = 1 - g / 255;
      let y = 1 - b / 255;
      let k = Math.min(c, m, y);
      c = ((c - k) / (1 - k)) * 100;
      m = ((m - k) / (1 - k)) * 100;
      y = ((y - k) / (1 - k)) * 100;
      k *= 100;
      return { c: Math.round(c), m: Math.round(m), y: Math.round(y), k: Math.round(k) };
    }

    function rgbCompand(c) {
      return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
    }
    function rgbUncompand(c) {
      return c <= 0.0031308 ? c * 12.92 : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;
    }
    function labFn(t) {
      return t > 0.008856 ? Math.pow(t, 1 / 3) : (7.787 * t) + (16 / 116);
    }
    function labInvFn(t) {
      const t3 = Math.pow(t, 3);
      return t3 > 0.008856 ? t3 : (t - 16 / 116) / 7.787;
    }

    function rgbToLch(r, g, b) {
      r = rgbCompand(r / 255); g = rgbCompand(g / 255); b = rgbCompand(b / 255);
      const x = r * 0.4124 + g * 0.3576 + b * 0.1805;
      const y = r * 0.2126 + g * 0.7152 + b * 0.0722;
      const z = r * 0.0193 + g * 0.1192 + b * 0.9505;
      const X = x / 0.95047, Y = y / 1.0, Z = z / 1.08883;
      const fx = labFn(X), fy = labFn(Y), fz = labFn(Z);
      const L = 116 * fy - 16;
      const a = 500 * (fx - fy);
      const b_ = 200 * (fy - fz);
      const C = Math.sqrt(a * a + b_ * b_);
      let H = Math.atan2(b_, a) * (180 / Math.PI);
      if (H < 0) H += 360;
      return { l: +L.toFixed(2), c: +C.toFixed(2), h: +H.toFixed(2) };
    }

    function lchToRgb(L, C, H) {
      const hRad = H * Math.PI / 180;
      const a = C * Math.cos(hRad);
      const b_ = C * Math.sin(hRad);
      const fy = (L + 16) / 116;
      const fx = fy + a / 500;
      const fz = fy - b_ / 200;
      const X = labInvFn(fx) * 0.95047;
      const Y = labInvFn(fy) * 1.0;
      const Z = labInvFn(fz) * 1.08883;
      let r = X * 3.2406 + Y * -1.5372 + Z * -0.4986;
      let g = X * -0.9689 + Y * 1.8758 + Z * 0.0415;
      let b = X * 0.0557 + Y * -0.2040 + Z * 1.0570;
      r = rgbUncompand(r); g = rgbUncompand(g); b = rgbUncompand(b);
      return {
        r: Math.max(0, Math.min(255, Math.round(r * 255))),
        g: Math.max(0, Math.min(255, Math.round(g * 255))),
        b: Math.max(0, Math.min(255, Math.round(b * 255)))
      };
    }

    function updateColorDisplay(r, g, b) {
      sliders.forEach(color => updateSliderFill(sliderElements[color]));
      if (Number(numberInputs.red.value) !== r) numberInputs.red.value = r;
      if (Number(numberInputs.green.value) !== g) numberInputs.green.value = g;
      if (Number(numberInputs.blue.value) !== b) numberInputs.blue.value = b;
      valueDisplays.colorBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
      const format = valueDisplays.formatSelect.value;
      if (format === "hex") {
        valueDisplays.colorInput.value = rgbToHex(r, g, b);
      } else if (format === "hsl") {
        const hsl = rgbToHsl(r, g, b);
        valueDisplays.colorInput.value = `${hsl.h}, ${hsl.s}%, ${hsl.l}`;
      } else if (format === "cmyk") {
        const cmyk = rgbToCmyk(r, g, b);
        valueDisplays.colorInput.value = `${cmyk.c}%, ${cmyk.m}%, ${cmyk.y}%, ${cmyk.k}%`;
      } else if (format === "lch") {
        const lch = rgbToLch(r, g, b);
        valueDisplays.colorInput.value = `${lch.l}%, ${lch.c}, ${lch.h}`;
      }
    }

    function syncFromSliders() {
      const r = Number(sliderElements.red.value);
      const g = Number(sliderElements.green.value);
      const b = Number(sliderElements.blue.value);
      updateColorDisplay(r, g, b);
    }

    function syncFromNumbers() {
      const r = Number(numberInputs.red.value);
      const g = Number(numberInputs.green.value);
      const b = Number(numberInputs.blue.value);
      sliderElements.red.value = r;
      sliderElements.green.value = g;
      sliderElements.blue.value = b;
      updateColorDisplay(r, g, b);
    }

    function syncFromTextInput() {
      let val = valueDisplays.colorInput.value.trim().toLowerCase();
      const format = valueDisplays.formatSelect.value;
      if (format === "hex") {
        if (!val.startsWith("#")) val = "#" + val;
        const rgb = hexToRgb(val);
        if (rgb) setRGBandUpdate(rgb.r, rgb.g, rgb.b);
      } else if (format === "hsl") {
        const match = val.match(/(\d+),\s*(\d+)%?,\s*(\d+)%?/);
        if (match) {
          const h = +match[1], s = +match[2] / 100, l = +match[3] / 100;
          const rgb = hslToRgb(h, s, l);
          setRGBandUpdate(rgb.r, rgb.g, rgb.b);
        }
      } else if (format === "cmyk") {
        const match = val.match(/(\d+)%?,\s*(\d+)%?,\s*(\d+)%?,\s*(\d+)%?/);
        if (match) {
          const c = +match[1] / 100, m = +match[2] / 100, y = +match[3] / 100, k = +match[4] / 100;
          const rgb = cmykToRgb(c, m, y, k);
          setRGBandUpdate(rgb.r, rgb.g, rgb.b);
        }
      } else if (format === "lch") {
        const match = val.match(/([\d.]+)%?,\s*([\d.]+),\s*([\d.]+)/);
        if (match) {
          const l = +match[1], c = +match[2], h = +match[3];
          const rgb = lchToRgb(l, c, h);
          setRGBandUpdate(rgb.r, rgb.g, rgb.b);
        }
      }
    }

    function hslToRgb(h, s, l) {
      h /= 360;
      let r, g, b;
      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1 / 6) return p + (q - p) * 6 * t;
          if (t < 1 / 2) return q;
          if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
          return p;
        }
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }
      return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
    }

    function cmykToRgb(c, m, y, k) {
      const r = 255 * (1 - c) * (1 - k);
      const g = 255 * (1 - m) * (1 - k);
      const b = 255 * (1 - y) * (1 - k);
      return { r: Math.round(r), g: Math.round(g), b: Math.round(b) };
    }

    // === Event Listeners ===
    sliders.forEach(color => {
      sliderElements[color].addEventListener("input", () => {
        numberInputs[color].value = sliderElements[color].value;
        syncFromSliders();
      });
      numberInputs[color].addEventListener("input", () => {
        let val = Number(numberInputs[color].value);
        val = isNaN(val) ? 0 : Math.max(0, Math.min(255, val));
        numberInputs[color].value = val;
        sliderElements[color].value = val;
        syncFromNumbers();
      });
    });

    valueDisplays.formatSelect.addEventListener("change", syncFromSliders);
    valueDisplays.colorInput.addEventListener("change", syncFromTextInput);

    // Initialize display
    syncFromSliders();

    // Respond to dark mode changes
    window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", () => {
      sliders.forEach(color => updateSliderFill(sliderElements[color]));
    });

    // EyeDropper (Cmd + P)
    window.addEventListener("keydown", async (e) => {
      if (e.metaKey && (e.key === "P" || e.key === "p")) {
        e.preventDefault();
        if ("EyeDropper" in window) {
          try {
            const eyeDropper = new EyeDropper();
            const result = await eyeDropper.open();
            const rgb = hexToRgb(result.sRGBHex);
            if (rgb) setRGBandUpdate(rgb.r, rgb.g, rgb.b);
          } catch (err) {
            console.error("EyeDropper failed:", err);
          }
        } else {
          alert("Your browser does not support the EyeDropper API.");
        }
      }
    });

  </script>
</body>

</html>
